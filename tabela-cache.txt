Public Sub Main
On Error GoTo FAIL
	If ( Not ( InTransaction ) ) Then StartTransaction
	Dim qInsert As BPesquisa
	Set qInsert = NewQuery

	qInsert.Add("DELETE FROM K_PC_CACHEVENDASBASE WHERE YEAR(DATAEMISSAO) >= 2015 ")
	qInsert.ExecSQL

	qInsert.Add("INSERT INTO K_PC_CACHEVENDASBASE                                                                                                       ")
	qInsert.Add("            (DATAGERACAOREGISTRO,                                                                                                      ")
	qInsert.Add("             ANTECEDENCIA,                                                                                                             ")
	qInsert.Add("             MARGEM,                                                                                                                   ")
	qInsert.Add("             PERCMARGEM,                                                                                                               ")
	qInsert.Add("             QTDDIARIAS,                                                                                                               ")
	qInsert.Add("             VALORDIARIA,                                                                                                              ")

	qInsert.Add("             TARIFACONCILIACAO,                                                                                                        ")
	qInsert.Add("             TAXASCONCILIACAO,                                                                                                         ")
	qInsert.Add("             TAXADUCONCILIACAO,                                                                                                        ")
	qInsert.Add("             COMISSAOCONCILIACAO,                                                                                                      ")

	qInsert.Add("             VENDABASE.HANDLEACCOUNTING,                                                                                               ")
	qInsert.Add("             HANDLEFILIAL,                                                                                                             ")
	qInsert.Add("             NOMEFILIAL,                                                                                                               ")
	qInsert.Add("             HANDLEGRUPOEMPRESARIAL,                                                                                                   ")
	qInsert.Add("             GRUPOEMPRESARIAL,                                                                                                         ")
	qInsert.Add("             HANDLECLIENTE,                                                                                                            ")
	qInsert.Add("             NOMECLIENTE,                                                                                                              ")
	qInsert.Add("             PASSAGEIRONAOCAD,                                                                                                         ")
	qInsert.Add("             BILHETE,                                                                                                                  ")
	qInsert.Add("             CODIGOFATURA,                                                                                                             ")
	qInsert.Add("             EMISSAOFATURA,                                                                                                            ")
	qInsert.Add("             VENCIMENTOFATURA,                                                                                                         ")
	qInsert.Add("             NRDOCUMENTOFATURA,                                                                                                        ")
	qInsert.Add("             HANDLEFORNECEDOR,                                                                                                         ")
	qInsert.Add("             NOMEFORNECEDOR,                                                                                                           ")
	qInsert.Add("             APELIDOFORNECEDOR,                                                                                                        ")
	qInsert.Add("             HANDLEAGENTE,                                                                                                             ")
	qInsert.Add("             NOMEAGENTE,                                                                                                               ")
	qInsert.Add("             HANDLEPCC,                                                                                                                ")
	qInsert.Add("             PCC,                                                                                                                      ")
	qInsert.Add("             RLOC,                                                                                                                     ")
	qInsert.Add("             LOCALIZADORACIA,                                                                                                          ")
	qInsert.Add("             HANDLECENTROCUSTO,                                                                                                        ")
	qInsert.Add("             CENTROCUSTO,                                                                                                              ")
	qInsert.Add("             APROVADOR,                                                                                                                ")
	qInsert.Add("             PROJETO,                                                                                                                  ")
	qInsert.Add("             REQUISICAO,                                                                                                               ")
	qInsert.Add("             TIPOROTA,                                                                                                                 ")
	qInsert.Add("             HANDLESOLICITANTE,                                                                                                        ")
	qInsert.Add("             NOMESOLICITANTE,                                                                                                          ")
	qInsert.Add("             TRECHO,                                                                                                                   ")
	qInsert.Add("             DATASOLICITACAO,                                                                                                          ")
	qInsert.Add("             DATAEMISSAO,                                                                                                              ")
	qInsert.Add("             DATACONCILIACAO,                                                                                                          ")
	qInsert.Add("             DATACONFIRMACAO,                                                                                                          ")
	qInsert.Add("             DATAIN,                                                                                                                   ")
	qInsert.Add("             DATAOUT,                                                                                                                  ")
	qInsert.Add("             PRODUTODESC,                                                                                                              ")
	qInsert.Add("             PRODUTO,                                                                                                                  ")
	qInsert.Add("             TIPOMISCELANIO,                                                                                                           ")
	qInsert.Add("             TIPO,                                                                                                                     ")
	qInsert.Add("             TARIFA,                                                                                                                   ")
	qInsert.Add("             TAXAS,                                                                                                                    ")
	qInsert.Add("             COMISSAO,                                                                                                                 ")
	qInsert.Add("             DESCONTO,                                                                                                                 ")
	qInsert.Add("             FEE,                                                                                                                      ")
	qInsert.Add("             TAXADU,                                                                                                                   ")
	qInsert.Add("             TAXAADMCC,                                                                                                                ")
	qInsert.Add("             MARKUP,                                                                                                                   ")
	qInsert.Add("             TAXAADM,                                                                                                                  ")
	qInsert.Add("             INCENTIVO,                                                                                                                ")
	qInsert.Add("             VALOROVER,                                                                                                                ")
	qInsert.Add("             DESCONTOCIA,                                                                                                              ")
	qInsert.Add("             QUANTIDADEACC,                                                                                                            ")
	qInsert.Add("             MATRICULA,                                                                                                                ")
	qInsert.Add("             EMPENHO,                                                                                                                  ")
	qInsert.Add("             HANDLEORIGEM,                                                                                                             ")
	qInsert.Add("             NOMEORIGEM,                                                                                                               ")
	qInsert.Add("			 TODOSTRECHOS,                                                                                                              ")
	qInsert.Add("			 RLOCCIATRECHOS,                                                                                                            ")
	qInsert.Add("			 NUMEROVOOSTRECHOS,                                                                                                         ")
	qInsert.Add("             QTDTRECHOS,                                                                                                               ")
	qInsert.Add("             TRECHO1,                                                                                                                  ")
	qInsert.Add("             TRECHO2,                                                                                                                  ")
	qInsert.Add("             TRECHO3,                                                                                                                  ")
	qInsert.Add("             TRECHO4,                                                                                                                  ")
	qInsert.Add("             SITUACAO,                                                                                                                 ")
	qInsert.Add("             REEMISSAO,                                                                                                                ")
	qInsert.Add("             TARIFACHEIA,                                                                                                              ")
	qInsert.Add("             TARIFAMINIMA,                                                                                                             ")
	qInsert.Add("             HANDLEEVENTO,                                                                                                             ")
	qInsert.Add("             EVENTO,                                                                                                                   ")
	qInsert.Add("             FORMARECEBIMENTO,                                                                                                         ")
	qInsert.Add("             FORMARECEBIMENTODESC,                                                                                                     ")
	qInsert.Add("             HANDLECONSOLIDADOR,                                                                                                       ")
	qInsert.Add("             CONSOLIDADOR,                                                                                                             ")
	qInsert.Add("             INFOS,                                                                                                                    ")
	qInsert.Add("             HANDLEPROMOTOR,                                                                                                           ")
	qInsert.Add("             PROMOTOR,                                                                                                                 ")
	qInsert.Add("             HANDLEPROMOTORMANUTENCAO,                                                                                                 ")
	qInsert.Add("             PROMOTORMANUTENCAO,                                                                                                       ")
	qInsert.Add("			 VALOROVERREPASSADO,                                                                                                        ")
	qInsert.Add("			 MUNICIPIOFORNECEDOR,                                                                                                       ")
	qInsert.Add("			 TIPOAPARTAMENTO,                                                                                                           ")
	qInsert.Add("			 FORMADEPAGAMENTODESC,                                                                                                      ")
	qInsert.Add("			 HANDLECENTROCUSTOINTERNO,                                                                                                  ")
	qInsert.Add("			 NOMECENTROCUSTOINTERNO,                                                                                                    ")
	qInsert.Add("			 TARIFAEMISSAO,                                                                                                             ")
	qInsert.Add("			 TAXASEMISSAO,                                                                                                              ")
	qInsert.Add("			 TAXADUEMISSAO,                                                                                                             ")
	qInsert.Add("			 COMISSAOEMISSAO,                                                                                                           ")
	qInsert.Add("			 TOTALMENTECONCILIADO,                                                                                                      ")
	qInsert.Add("			 CONTINENTE,                                                                                                                ")
	qInsert.Add("			 REGIAO,                                                                                                                    ")
	qInsert.Add("            HANDLEESTADOFORNECEDOR,NOMEESTADOFORNECEDOr,HANDLEPAISFORNECEDOR,NOMEPAISFORNECEDOR, 								        ")
	qInsert.Add("            HANDLEVIAGEM, NOMEVIAGEM, HANDLEVIAJANTE, NOMEVIAJANTE,                                                                   	")
	qInsert.Add("			 MENORTARIFA, JUSTIFICATIVAMENORTARIFA, ANTECEDENCIAMINIMA, JUSTIFICATIVAANTECEDENCIA,										")
	qInsert.Add("			 CIAPREFERENCIAL, JUSTIFICATIVACIAPREFERENCIAL, SELECIONARCIA, JUSTIFICATIVASELECIONARCIA, 									")
	qInsert.Add("			 VOOSMENORTARIFA, REMARCACAO, DATAAUTORIZACAO, TIPOPAX, ORIGEMEMISSAO, CARGOPASSAGEIRO, CARGOAUTORIZADOR )					")
	qInsert.Add("SELECT Getdate()                                                                  DATAGERACAOREGISTRO,                                 ")
	qInsert.Add("       CASE                                                                                                                            ")
	qInsert.Add("         WHEN Datediff(DAY, VENDABASE.DATAEMISSAO, VENDABASE.DATAIN) < 0 THEN 0                                                        ")
	qInsert.Add("         ELSE Datediff(DAY, VENDABASE.DATAEMISSAO, DATAIN)                                                                             ")
	qInsert.Add("       END                                                                        ANTECEDENCIA,                                        ")
	qInsert.Add("       ( ( VENDABASE.FEE + VENDABASE.TAXADU                                                                                            ")
	qInsert.Add("           + VENDABASE.COMISSAO + VENDABASE.MARKUP                                                                                     ")
	qInsert.Add("           + VENDABASE.TAXAADM + VENDABASE.INCENTIVO                                                                                   ")
	qInsert.Add("           + VENDABASE.VALOROVER + VENDABASE.DESCONTOCIA ) - VENDABASE.DESCONTO ) MARGEM,                                              ")
	qInsert.Add("       CASE                                                                                                                            ")
	qInsert.Add("         WHEN VENDABASE.TARIFA <= 0 THEN 0                                                                                             ")
	qInsert.Add("         ELSE ( ( 100 / VENDABASE.TARIFA ) * ( ( VENDABASE.FEE + VENDABASE.TAXADU                                                      ")
	qInsert.Add("                                                 + VENDABASE.COMISSAO + VENDABASE.MARKUP                                               ")
	qInsert.Add("                                                 + VENDABASE.TAXAADM + VENDABASE.INCENTIVO                                             ")
	qInsert.Add("                                                 + VENDABASE.VALOROVER + VENDABASE.DESCONTOCIA ) - VENDABASE.DESCONTO ) )              ")
	qInsert.Add("       END                                                                        PERCMARGEM,                                          ")
	qInsert.Add("       CASE                                                                                                                            ")
	qInsert.Add("         WHEN Datediff(DAY, VENDABASE.DATAIN, VENDABASE.DATAOUT) <= 1 THEN 1                                                           ")
	qInsert.Add("         ELSE Datediff(DAY, VENDABASE.DATAIN, VENDABASE.DATAOUT)                                                                       ")
	qInsert.Add("       END                                                                        QTDDIARIAS,                                          ")
	qInsert.Add("       CASE                                                                                                                            ")
	qInsert.Add("         WHEN VENDABASE.PRODUTO IN ( 2, 3, 4, 8 ) THEN                                                                                 ")
	qInsert.Add("           CASE                                                                                                                        ")
	qInsert.Add("             WHEN Datediff(DAY, VENDABASE.DATAIN, VENDABASE.DATAOUT) <= 1 THEN VENDABASE.TARIFA                                        ")
	qInsert.Add("             ELSE VENDABASE.TARIFA / Datediff(DAY, VENDABASE.DATAIN, VENDABASE.DATAOUT)                                                ")
	qInsert.Add("           END                                                                                                                         ")
	qInsert.Add("         ELSE VENDABASE.TARIFA                                                                                                         ")
	qInsert.Add("       END                                                                        VALORDIARIA,                                         ")

	qInsert.Add("       CASE WHEN VENDABASE.TOTALMENTECONCILIADO = 'S' THEN VENDABASE.TARIFA ELSE 0 END TARIFACONCILIACAO,                              ")
	qInsert.Add("       CASE WHEN VENDABASE.TOTALMENTECONCILIADO = 'S' THEN VENDABASE.TAXAS ELSE 0 END TAXASCONCILIACAO,                                ")
	qInsert.Add("       CASE WHEN VENDABASE.TOTALMENTECONCILIADO = 'S' THEN VENDABASE.TAXADU ELSE 0 END TAXADUCONCILIACAO,                              ")
	qInsert.Add("       CASE WHEN VENDABASE.TOTALMENTECONCILIADO = 'S' THEN VENDABASE.COMISSAO ELSE 0 END COMISSAOCONCILIACAO,                          ")

	qInsert.Add("       *                                                                                                                               ")
	qInsert.Add("FROM   (SELECT ACC.HANDLE                                                                                                              ")
	qInsert.Add("                      HANDLEACCOUNTING,                                                                                                ")
	qInsert.Add("               FILIAL.HANDLE                                                                                                           ")
	qInsert.Add("                      HANDLEFILIAL,                                                                                                    ")
	qInsert.Add("               FILIAL.NOME                                                                                                             ")
	qInsert.Add("                      NOMEFILIAL,                                                                                                      ")
	qInsert.Add("               GRUPOEMPRESARIAL.HANDLE                                                                                                 ")
	qInsert.Add("                      HANDLEGRUPOEMPRESARIAL,                                                                                          ")
	qInsert.Add("               GRUPOEMPRESARIALPESSOA.NOME                                                                                             ")
	qInsert.Add("                      GRUPOEMPRESARIAL,                                                                                                ")
	qInsert.Add("               CLIENTE.HANDLE                                                                                                          ")
	qInsert.Add("                      HANDLECLIENTE,                                                                                                   ")
	qInsert.Add("               CLIENTE.NOME                                                                                                            ")
	qInsert.Add("                      NOMECLIENTE,                                                                                                     ")
	qInsert.Add("               ACC.PASSAGEIRONAOCAD,                                                                                                   ")
	qInsert.Add("               ACC.BILHETE,                                                                                                            ")
	qInsert.Add("               (SELECT Max(FATURA.CODIGO)                                                                                              ")
	qInsert.Add("                FROM   BB_FATURAS FATURA                                                                                               ")
	qInsert.Add("                       JOIN BB_FATURADOCUMENTOS FATDOC                                                                                 ")
	qInsert.Add("                         ON ( FATDOC.FATURA = FATURA.HANDLE                                                                            ")
	qInsert.Add("                              AND FATDOC.ACCOUNTING = ACC.HANDLE ))                                                                    ")
	qInsert.Add("                      CODIGOFATURA,                                                                                                    ")
	qInsert.Add("               (SELECT Max(FATURA.DATA)                                                                                                ")
	qInsert.Add("                FROM   BB_FATURAS FATURA                                                                                               ")
	qInsert.Add("                       JOIN BB_FATURADOCUMENTOS FATDOC                                                                                 ")
	qInsert.Add("                         ON ( FATDOC.FATURA = FATURA.HANDLE                                                                            ")
	qInsert.Add("                              AND FATDOC.ACCOUNTING = ACC.HANDLE ))                                                                    ")
	qInsert.Add("                      EMISSAOFATURA,                                                                                                   ")
	qInsert.Add("               (SELECT Max(FATURA.DATAVENCIMENTO)                                                                                      ")
	qInsert.Add("                FROM   BB_FATURAS FATURA                                                                                               ")
	qInsert.Add("                       JOIN BB_FATURADOCUMENTOS FATDOC                                                                                 ")
	qInsert.Add("                         ON ( FATDOC.FATURA = FATURA.HANDLE                                                                            ")
	qInsert.Add("                              AND FATDOC.ACCOUNTING = ACC.HANDLE ))                                                                    ")
	qInsert.Add("                      VENCIMENTOFATURA,                                                                                                ")
	qInsert.Add("               (SELECT Max(DOCUMENTO.DOCUMENTODIGITADO)                                                                                ")
	qInsert.Add("                FROM   BB_FATURAS FATURA                                                                                               ")
	qInsert.Add("                       JOIN FN_DOCUMENTOS DOCUMENTO                                                                                    ")
	qInsert.Add("                         ON ( DOCUMENTO.HANDLE = FATURA.DOCUMENTOFATURA )                                                              ")
	qInsert.Add("                WHERE  FATURA.HANDLE IN (SELECT FATURA                                                                                 ")
	qInsert.Add("                                         FROM   BB_FATURADOCUMENTOS                                                                    ")
	qInsert.Add("                                         WHERE  ACCOUNTING = ACC.HANDLE))                                                              ")
	qInsert.Add("                      NRDOCUMENTOFATURA,                                                                                               ")
	qInsert.Add("               FORNECEDOR.HANDLE                                                                                                       ")
	qInsert.Add("                      HANDLEFORNECEDOR,                                                                                                ")
	qInsert.Add("               FORNECEDOR.NOME                                                                                                         ")
	qInsert.Add("                      NOMEFORNECEDOR,                                                                                                  ")
	qInsert.Add("               FORNECEDOR.APELIDO                                                                                                      ")
	qInsert.Add("                      APELIDOFORNECEDOR,                                                                                               ")
	qInsert.Add("               AGENTE.HANDLE                                                                                                           ")
	qInsert.Add("                      HANDLEAGENTE,                                                                                                    ")
	qInsert.Add("               AGENTE.NOME                                                                                                             ")
	qInsert.Add("                      NOMEAGENTE,                                                                                                      ")
	qInsert.Add("               PCC.HANDLE                                                                                                              ")
	qInsert.Add("                      HANDLEPCC,                                                                                                       ")
	qInsert.Add("               PCC.PCC                                                                                                                 ")
	qInsert.Add("               PCC,                                                                                                                    ")
	qInsert.Add("               BB.BB_RLOC                                                                                                              ")
	qInsert.Add("               RLOC,                                                                                                                   ")
	qInsert.Add("               BB.LOCALIZADORACIA,                                                                                                     ")
	qInsert.Add("               CENTROCUSTO.HANDLE                                                                                                      ")
	qInsert.Add("                      HANDLECENTROCUSTO,                                                                                               ")
	qInsert.Add("               CENTROCUSTO.CENTROCUSTO                                                                                                 ")
	qInsert.Add("               + CENTROCUSTO.DESCRICAO                                                                                                 ")
	qInsert.Add("                      CENTROCUSTO,                                                                                                     ")
	qInsert.Add("               ACC.INFAPROVADOR                                                                                                        ")
	qInsert.Add("                      APROVADOR,                                                                                                       ")
	qInsert.Add("               ACC.PROJETO,                                                                                                            ")
	qInsert.Add("               ACC.REQUISICAOPG,                                                                                                       ")
	qInsert.Add("               CASE                                                                                                                    ")
	qInsert.Add("                 WHEN ACC.FORNECEDOR = 12022 THEN 'Internacional'                                                                      ")
	qInsert.Add("                 WHEN ACC.TIPOROTA = 'I' THEN 'Internacional'                                                                          ")
	qInsert.Add("                 WHEN ACC.PRODUTO IN ( 1, 5, 6, 7 ) THEN 'Nacional'                                                                    ")
	qInsert.Add("                 WHEN ACC.PRODUTO IN ( 2, 3, 4, 8 )                                                                                    ")
	qInsert.Add("                      AND Upper(PAIS.NOME) <> 'BRASIL' THEN 'Internacional'                                                            ")
	qInsert.Add("                 WHEN ACC.PRODUTO IN ( 2, 3, 4, 8 ) THEN 'Nacional'                                                                    ")
	qInsert.Add("               END                                                                                                                     ")
	qInsert.Add("                      TIPOROTA,                                                                                                        ")
	qInsert.Add("               SOLICITANTE.HANDLE                                                                                                      ")
	qInsert.Add("                      HANDLESOLICITANTE,                                                                                               ")
	qInsert.Add("               SOLICITANTE.NOME                                                                                                        ")
	qInsert.Add("                      NOMESOLICITANTE,                                                                                                 ")
	qInsert.Add("               CASE                                                                                                                    ")
	qInsert.Add("                 WHEN ACC.PRODUTO IN ( 1, 5, 6, 7 ) THEN ACC.TRECHOS                                                                   ")
	qInsert.Add("                 WHEN ACC.PRODUTO = 2 THEN MUNICIPIOFORNECEDOR.NOME + '/'                                                              ")
	qInsert.Add("                                           + ESTADOFORNECEDOR.SIGLA                                                                    ")
	qInsert.Add("                 WHEN ACC.PRODUTO = 3 THEN ACC.BB_CARRO_RETIRADA_LOCAL                                                                 ")
	qInsert.Add("                 WHEN ACC.PRODUTO = 4 THEN ACC.BB_MISC_ENTRADA_LOCAL                                                                   ")
	qInsert.Add("               END                                                                                                                     ")
	qInsert.Add("               TRECHO,                                                                                                                 ")
	qInsert.Add("               ACC.INFDATASOLICITACAO                                                                                                  ")
	qInsert.Add("                      DATASOLICITACAO,                                                                                                 ")
	qInsert.Add("               ACC.DATAEMISSAO,                                                                                                        ")
	qInsert.Add("               CASE                                                                                                                    ")
	qInsert.Add("			     WHEN ACC.PRODUTO IN ( 1,5,6,7 ) THEN ACC.DATAEMISSAO                                                                   ")
	qInsert.Add("				 WHEN ( ACC. PRODUTO  IN ( 2,3,4,8 )                                                                                    ")
	qInsert.Add("				   AND ( ACC.FORMADEPAGAMENTO IN (1,3,4) )                                                                              ")
	qInsert.Add("				   AND ( ACC.FORMADEPAGAMENTO = 5 AND (ACC.HANDLE NOT IN (SELECT VDO.ACCOUNTING                                         ")
	qInsert.Add("							FROM BB_VENDASDOCUMENTOS VDO                                                                                ")
	qInsert.Add("							WHERE VDO.ACCOUNTING = ACC.HANDLE                                                                           ")
	qInsert.Add("							AND VDO.PESSOA = ACC.FORNECEDOR                                                                             ")
	qInsert.Add("							AND VDO.ENTRADASAIDA = 'E'                                                                                  ")
	qInsert.Add("							AND VDO.FORMAPAGAMENTO = 2) ) ) )  THEN  ACC.DATAEMISSAO                                                    ")
	qInsert.Add("                              WHEN ( ( ACC.PRODUTO IN ( 2,3,4,8 ) )                                                                    ")
	qInsert.Add("				     AND ( ( ACC.FORMADEPAGAMENTO = 2 )                                                                                  ")
	qInsert.Add("			             OR ( ( ACC.FORMADEPAGAMENTO = 5 )                                                                                      ")
	qInsert.Add("						     AND ( ACC.HANDLE IN ( SELECT VDO.ACCOUNTING FROM BB_VENDASDOCUMENTOS VDO                                                    ")
	qInsert.Add("                                              WHERE VDO.ACCOUNTING = ACC.HANDLE                                                        ")
	qInsert.Add("                                                AND VDO.PESSOA = ACC.FORNECEDOR                                                        ")
	qInsert.Add("                                                AND VDO.ENTRADASAIDA = 'E'                                                             ")
	qInsert.Add("                                                AND VDO.FORMAPAGAMENTO = 2 ) ) ) )                                                     ")
	qInsert.Add("					 	  AND ACC.HANDLE IN (SELECT VDO.ACCOUNTING                                                                                      ")
	qInsert.Add("                                  FROM BB_VENDASDOCUMENTOS VDO                                                                         ")
	qInsert.Add("                                  WHERE VDO.ACCOUNTING = ACC.HANDLE                                                                    ")
	qInsert.Add("									AND VDO.PESSOA = ACC.FORNECEDOR                                                                                               ")
	qInsert.Add("								    AND VDO.ENTRADASAIDA = 'E'                                                                                                 ")
	qInsert.Add("									AND VDO.FORMAPAGAMENTO = 2) ) THEN  ( SELECT MIN( VDO.DATACONCILIACAO )                                                       ")
	qInsert.Add("                                  FROM BB_VENDASDOCUMENTOS VDO                                                                         ")
	qInsert.Add("                                  WHERE VDO.ACCOUNTING = ACC.HANDLE                                                                    ")
	qInsert.Add("									AND VDO.PESSOA = ACC.FORNECEDOR                                                                                               ")
	qInsert.Add("								    AND VDO.ENTRADASAIDA = 'E'                                                                                                 ")
	qInsert.Add("									AND VDO.FORMAPAGAMENTO = 2 )                                                                                                  ")
	qInsert.Add("			   END DATACONCILIACAO,                                                                                                             ")
	qInsert.Add("               CASE                                                                                                                    ")
	qInsert.Add("			     WHEN ACC.PRODUTO IN ( 1, 5, 6, 7 ) THEN ACC.DATAEMISSAO                                                                        ")
	qInsert.Add(" 				 WHEN ACC.PRODUTO IN ( 2, 3, 4, 8 )                                                                                               ")
	qInsert.Add("					AND (                                                                                                                             ")
	qInsert.Add("							SELECT COUNT(VEN.HANDLE) TOTAL                                                                               ")
	qInsert.Add("							FROM BB_VENDASDOCUMENTOS VEN                                                                                 ")
	qInsert.Add("							WHERE VEN.ENTRADASAIDA = 'S'                                                                                 ")
	qInsert.Add("							AND VEN.ACCOUNTING = ACC.HANDLE                                                                              ")
	qInsert.Add("							AND VEN.PESSOA = ACC.BB_CLIENTE                                                                              ")
	qInsert.Add("							AND VEN.CONCILIADO = 'S'                                                                                     ")
	qInsert.Add("							AND VEN.CANCELADO = 'N'                                                                                                         ")
	qInsert.Add("							AND VEN.DATACONCILIACAO IS NOT NULL                                                                                             ")
	qInsert.Add("						) > 0 THEN (                                                                                                                     ")
	qInsert.Add("									SELECT MIN(VEN.DATACONCILIACAO)                                                                                               ")
	qInsert.Add("									FROM BB_VENDASDOCUMENTOS VEN                                                                                                  ")
	qInsert.Add("									WHERE VEN.ENTRADASAIDA = 'S'                                                                                                  ")
	qInsert.Add("									AND VEN.ACCOUNTING = ACC.HANDLE                                                                                               ")
	qInsert.Add("									AND VEN.PESSOA = ACC.BB_CLIENTE                                                                                               ")
	qInsert.Add("									AND VEN.CONCILIADO = 'S'                                                                                                      ")
	qInsert.Add("									AND VEN.CANCELADO = 'N'                                                                                                       ")
	qInsert.Add("									AND VEN.DATACONCILIACAO IS NOT NULL                                                                                           ")
	qInsert.Add("									)                                                                                                                             ")
	qInsert.Add("				  ELSE ACC.DATAEMISSAO                                                                                                             ")
	qInsert.Add("				END DATACONFIRMACAO,                                                                                                               ")
	qInsert.Add("               CASE                                                                                                                    ")
	qInsert.Add("                 WHEN ACC.PRODUTO IN ( 1, 5, 6, 7 ) THEN (SELECT Min(TRECHO.BB_AEREO_DATA_VOO)                                         ")
	qInsert.Add("                                                          FROM   BB_TRECHOACCOUNTING TRE                                               ")
	qInsert.Add("                                                                 JOIN BB_PNRTRECHOS TRECHO                                             ")
	qInsert.Add("                                                                   ON ( TRECHO.HANDLE = TRE.TRECHO )                                   ")
	qInsert.Add("                                                          WHERE  TRE.ACCOUNTING = ACC.HANDLE)                                          ")
	qInsert.Add("                 WHEN ACC.PRODUTO = 2 THEN ACC.BB_HOTEL_ENTRADA                                                                        ")
	qInsert.Add("                 WHEN ACC.PRODUTO = 3 THEN ACC.BB_CARRO_RETIRADA                                                                       ")
	qInsert.Add("                 WHEN ACC.PRODUTO = 4 THEN ACC.BB_MISC_ENTRADA                                                                         ")
	qInsert.Add("               END                                                                                                                     ")
	qInsert.Add("               DATAIN,                                                                                                                 ")
	qInsert.Add("               CASE                                                                                                                    ")
	qInsert.Add("                 WHEN ACC.PRODUTO IN ( 1, 5, 6, 7 ) THEN (SELECT Max(TRECHO.BB_AEREO_DATA_VOO)                                         ")
	qInsert.Add("                                                          FROM   BB_TRECHOACCOUNTING TRE                                               ")
	qInsert.Add("                                                                 JOIN BB_PNRTRECHOS TRECHO                                             ")
	qInsert.Add("                                                                   ON ( TRECHO.HANDLE = TRE.TRECHO )                                   ")
	qInsert.Add("                                                          WHERE  TRE.ACCOUNTING = ACC.HANDLE)                                          ")
	qInsert.Add("                 WHEN ACC.PRODUTO = 2 THEN ACC.BB_HOTEL_SAIDA                                                                          ")
	qInsert.Add("                 WHEN ACC.PRODUTO = 3 THEN ACC.BB_CARRO_ENTREGA                                                                        ")
	qInsert.Add("                 WHEN ACC.PRODUTO = 4 THEN ACC.BB_MISC_SAIDA                                                                           ")
	qInsert.Add("               END                                                                                                                     ")
	qInsert.Add("               DATAOUT                                                                                                                 ")
	qInsert.Add("                      ,                                                                                                                ")
	qInsert.Add("               CASE                                                                                                                    ")
	qInsert.Add("                 WHEN BB.REEMISSAO = 'S' THEN 'Re-emiss√£o'                                                                             ")
	qInsert.Add("                 WHEN ACC.PRODUTO IN( 1, 5, 6, 7 ) THEN 'Aereo'                                                                        ")
	qInsert.Add("                 WHEN ACC.PRODUTO = 2 THEN 'Hotel'                                                                                     ")
	qInsert.Add("                 WHEN ACC.PRODUTO = 3 THEN 'Locacao'                                                                                   ")
	qInsert.Add("                 WHEN ACC.PRODUTO IN ( 4, 8 ) THEN 'Diversos'                                                                          ")
	qInsert.Add("               END                                                                                                                     ")
	qInsert.Add("                      PRODUTODESC,                                                                                                     ")
	qInsert.Add("               CASE                                                                                                                    ")
	qInsert.Add("                 WHEN BB.REEMISSAO = 'S' THEN 9                                                                                        ")
	qInsert.Add("                 ELSE ACC.PRODUTO                                                                                                      ")
	qInsert.Add("               END                                                                                                                     ")
	qInsert.Add("               PRODUTO                                                                                                                 ")
	qInsert.Add("                      ,                                                                                                                ")
	qInsert.Add("               ACC.TIPOMISCELANIO,                                                                                                     ")
	qInsert.Add("               CASE                                                                                                                    ")
	qInsert.Add("                 WHEN ACC.FORNECEDOR = 12022 THEN 2                                                                                    ")
	qInsert.Add("                 WHEN ACC.PRODUTO IN ( 1, 5, 6, 7 )                                                                                    ")
	qInsert.Add("                      AND ACC.TIPOROTA = 'I' THEN 2                                                                                    ")
	qInsert.Add("                 WHEN ACC.PRODUTO IN ( 1, 5, 6, 7 ) THEN 1                                                                             ")
	qInsert.Add("                 WHEN ACC.PRODUTO IN ( 2, 3, 4, 8 )                                                                                    ")
	qInsert.Add("                      AND PAIS.NOME <> 'BRASIL' THEN 2                                                                                 ")
	qInsert.Add("                 WHEN ACC.PRODUTO IN ( 2, 3, 4, 8 ) THEN 1                                                                             ")
	qInsert.Add("               END                                                                                                                     ")
	qInsert.Add("               TIPO,                                                                                                                   ")
	qInsert.Add("               CASE                                                                                                                    ")
	qInsert.Add("                 WHEN ( ENTRADAFOR.HANDLE > 0 )                                                                                        ")
	qInsert.Add("                      AND ( ENTRADAFOR.HANDLE > 0 )                                                                                    ")
	qInsert.Add("                      AND ( ENTRADAFOR.TARIFA > 0                                                                                      ")
	qInsert.Add("                             OR ENTRADAFOR.TAXAS > 0 )                                                                                 ")
	qInsert.Add("                      AND ( ACC.FORMADEPAGAMENTO <> 5 ) THEN ENTRADAFOR.TARIFA                                                         ")
	qInsert.Add("                 WHEN ( VENDASDOC.ACCOUNTING > 0 )                                                                                     ")
	qInsert.Add("                      AND ( VENDASDOC.TARIFA > 0                                                                                       ")
	qInsert.Add("                             OR VENDASDOC.TAXAS > 0 )                                                                                  ")
	qInsert.Add("                      AND ( ACC.FORMADEPAGAMENTO <> 5 ) THEN VENDASDOC.TARIFA                                                          ")
	qInsert.Add("                 ELSE ( ACC.TARIFA )                                                                                                   ")
	qInsert.Add("               END + ISNULL(BSPALT.TARIFA_AC, 0)                                                                                       ")
	qInsert.Add("               TARIFA,                                                                                                                 ")
	qInsert.Add("               ( CASE                                                                                                                  ")
	qInsert.Add("			     WHEN ( VENDASDOC.ACCOUNTING > 0 )                                                                                              ")
	qInsert.Add("				   AND ( ACC.FORMADEPAGAMENTO <> 5 )                                                                                               ")
	qInsert.Add("				   AND ( ACC.FORMARECEBIMENTO <> 15 ) THEN ( VENDASDOC.TAXAS )                                                                     ")
	qInsert.Add("				 WHEN ( ENTRADAFOR.HANDLE > 0 )                                                                                                    ")
	qInsert.Add("				   AND ( ACC.FORMADEPAGAMENTO <> 5 )                                                                                               ")
	qInsert.Add("				   AND ( ACC.FORMARECEBIMENTO <> 15 ) THEN ( ENTRADAFOR.TAXAS )                                                                    ")
	qInsert.Add("				 ELSE ( ACC.TAXA + ACC.OUTRASTAXAS + ISNULL(ACC.EXTRAS, 0) )                                                                       ")
	qInsert.Add("			   END + ISNULL(BSPALT.TAXA_AC, 0) ) TAXAS,                                                                                         ")
	qInsert.Add("               CASE                                                                                                                    ")
	qInsert.Add("                 WHEN ( ACC.PRODUTO NOT IN( 1, 5, 6, 7 )                                                                               ")
	qInsert.Add("                        AND COMI.HANDLE > 0                                                                                            ")
	qInsert.Add("                        AND ( ACC.FORMADEPAGAMENTO <> 5 ) ) THEN ( COMI.VALORNOMINALAJUSTADO                                           ")
	qInsert.Add("                                                                   + ISNULL(BSPALT.COMISSAO_AC, 0) )                                   ")
	qInsert.Add("                 WHEN ( ACC.PRODUTO NOT IN( 1, 5, 6, 7 )                                                                               ")
	qInsert.Add("                        AND COMIFOR.HANDLE > 0                                                                                         ")
	qInsert.Add("                        AND ( ACC.FORMADEPAGAMENTO <> 5 ) ) THEN ( COMIFOR.COMISSAO                                                    ")
	qInsert.Add("                                                                   + ISNULL(BSPALT.COMISSAO_AC, 0) )                                   ")
	qInsert.Add("                 WHEN ( ISNULL(ACC.VALORCOMISSAORECEBIDA, 0) > 0 ) THEN ( ISNULL(ACC.VALORCOMISSAORECEBIDA, 0)                         ")
	qInsert.Add("                                                                          + ISNULL(BSPALT.COMISSAO_AC, 0) )                            ")
	qInsert.Add("                 WHEN ( ACC.FORMADEPAGAMENTO = 5 ) THEN ( ISNULL(MULTIPLAS.COMISSAO, 0)                                                ")
	qInsert.Add("                                                          + ISNULL(BSPALT.COMISSAO_AC, 0) )                                            ")
	qInsert.Add("                 ELSE ( ACC.COMISSAO + ISNULL(BSPALT.COMISSAO_AC, 0) )                                                                 ")
	qInsert.Add("               END    COMISSAO,                                                                                                        ")
	qInsert.Add("               CASE                                                                                                                    ")
	qInsert.Add("                 WHEN ( ( VENDASDOC.ACCOUNTING > 0 )                                                                                   ")
	qInsert.Add("                        AND ( VENDASDOC.DESCONTO > 0 ) ) THEN VENDASDOC.DESCONTO                                                       ")
	qInsert.Add("                 ELSE ISNULL(ADMCARTAO.DESCONTO, 0)                                                                                    ")
	qInsert.Add("               END    DESCONTO,                                                                                                        ")
	qInsert.Add("               CASE                                                                                                                    ")
	qInsert.Add("                 WHEN ( ACC.FORMARECEBIMENTO IN ( 3, 12 )                                                                              ")
	qInsert.Add("                        AND VENDASDOC.MANAGEMENTFEE > 0 ) THEN VENDASDOC.MANAGEMENTFEE                                                 ")
	qInsert.Add("                 WHEN ( ACC.MANAGEMENTFEE > 0 ) THEN ACC.MANAGEMENTFEE                                                                 ")
	qInsert.Add("                 WHEN ( ACC.MANAGEMENTFEEPREVISTO > 0 ) THEN ACC.MANAGEMENTFEEPREVISTO                                                 ")
	qInsert.Add("                 ELSE ISNULL((SELECT ( REG.VALORAPURADO * -1 )                                                                         ")
	qInsert.Add("                              FROM   BB_APURACAOFEEREGISTROS REG (NOLOCK)                                                              ")
	qInsert.Add("                                     INNER JOIN BB_APURACOESFEE AP (NOLOCK)                                                            ")
	qInsert.Add("                                             ON ( AP.HANDLE = REG.APURACAOFEE )                                                        ")
	qInsert.Add("                              WHERE  REG.RLOC = ACC.HANDLE                                                                             ")
	qInsert.Add("                                     AND AP.TIPO = 1), 0)                                                                              ")
	qInsert.Add("               END FEE,                                                                                                                ")
	qInsert.Add("               ( ACC.TAXADU + ISNULL(BSPALT.TAXADUAC, 0) ) TAXADU,                                                                     ")
	qInsert.Add("               ACC.TAXAADMCARTAO                                                                                                       ")
	qInsert.Add("                      TAXAADMCC,                                                                                                       ")
	qInsert.Add("               ACC.MARKUP MARKUP,                                                                                                      ")
	qInsert.Add("               ACC.TAXAADM TAXAADM,                                                                                                    ")
	qInsert.Add("               ( ACC.VALORINCENTIVORECEBIDO                                                                                            ")
	qInsert.Add("                 + ISNULL(BSPALT.INCENTIVO_AC, 0) ) INCENTIVO,                                                                         ")
	qInsert.Add("               ( ACC.VALOROVERRECEBIDO                                                                                                 ")
	qInsert.Add("                 + ISNULL(BSPALT.OVER_AC, 0) ) VALOROVER,                                                                              ")
	qInsert.Add("               ACC.DESCONTOCIA,                                                                                                        ")
	qInsert.Add("               ISNULL(ACC.QUANTIDADE, 0)                                                                                               ")
	qInsert.Add("                      QUANTIDADEACC,                                                                                                   ")
	qInsert.Add("               ACC.MATRICULA,                                                                                                          ")
	qInsert.Add("               ACC.EMPENHO,                                                                                                            ")
	qInsert.Add("               ORIGEMPEDIDO.HANDLE HANDLEORIGEM,                                                                                       ")
	qInsert.Add("               ORIGEMPEDIDO.NOME NOMEORIGEM,                                                                                           ")
	qInsert.Add("			   CASE                                                                                                                     ")
	qInsert.Add("                 WHEN ACC.PRODUTO IN ( 1, 5, 6, 7 ) THEN                                                                               ")
	qInsert.Add("												(SELECT TRECHO.BB_AEREO_ORIGEM + '/'                                                    ")
	qInsert.Add("				                                     + TRECHO.BB_AEREO_DESTINO + '/'  AS [text()]                                       ")
	qInsert.Add("                                                    FROM   BB_PNRACCOUNTINGS ACC1                                                      ")
	qInsert.Add("                                                           JOIN BB_TRECHOACCOUNTING TREACC                                             ")
	qInsert.Add("                                                             ON ( ACC1.HANDLE = TREACC.ACCOUNTING )                                    ")
	qInsert.Add("                                                           JOIN BB_PNRTRECHOS TRECHO                                                   ")
	qInsert.Add("                                                             ON ( TRECHO.HANDLE = TREACC.TRECHO )                                      ")
	qInsert.Add("                                                    WHERE  ACC1.HANDLE = ACC.HANDLE                                                    ")
	qInsert.Add("													ORDER BY TRECHO.BB_AEREO_DATA_VOO ASC, TRECHO.BB_AEREO_HRSAIDA ASC                  ")
	qInsert.Add("                                                    FOR XML PATH (''))                                                                 ")
	qInsert.Add("                END  TODOSTRECHOS,                                                                                                     ")
	qInsert.Add("			   CASE                                                                                                                     ")
	qInsert.Add("                 WHEN ACC.PRODUTO IN ( 1, 5, 6, 7 )  THEN (SELECT TRECHO.RLOCCIA + '/' AS [text()]                                     ")
	qInsert.Add("                                                    FROM   BB_PNRACCOUNTINGS ACC1                                                      ")
	qInsert.Add("                                                           JOIN BB_TRECHOACCOUNTING TREACC                                             ")
	qInsert.Add("                                                             ON ( ACC1.HANDLE = TREACC.ACCOUNTING )                                    ")
	qInsert.Add("                                                           JOIN BB_PNRTRECHOS TRECHO                                                   ")
	qInsert.Add("                                                             ON ( TRECHO.HANDLE = TREACC.TRECHO )                                      ")
	qInsert.Add("                                                    WHERE  ACC1.HANDLE = ACC.HANDLE AND TRECHO.RLOCCIA IS NULL                         ")
	qInsert.Add("													ORDER BY TRECHO.BB_AEREO_DATA_VOO ASC, TRECHO.BB_AEREO_HRSAIDA ASC                  ")
	qInsert.Add("                                                    FOR XML PATH (''))                                                                 ")
	qInsert.Add("                END  RLOCCIATRECHOS,                                                                                                   ")
	qInsert.Add("                CASE                                                                                                                   ")
	qInsert.Add("                 WHEN ACC.PRODUTO IN ( 1, 5, 6, 7 ) THEN (SELECT TRECHO.BB_AEREO_VOO + '/' AS [text()]                                 ")
	qInsert.Add("                                                    FROM   BB_PNRACCOUNTINGS ACC1                                                      ")
	qInsert.Add("                                                           JOIN BB_TRECHOACCOUNTING TREACC                                             ")
	qInsert.Add("                                                             ON ( ACC1.HANDLE = TREACC.ACCOUNTING )                                    ")
	qInsert.Add("                                                           JOIN BB_PNRTRECHOS TRECHO                                                   ")
	qInsert.Add("                                                             ON ( TRECHO.HANDLE = TREACC.TRECHO )                                      ")
	qInsert.Add("                                                    WHERE  ACC1.HANDLE = ACC.HANDLE AND TRECHO.BB_AEREO_VOO IS NOT NULL                ")
	qInsert.Add("													ORDER BY TRECHO.BB_AEREO_DATA_VOO ASC, TRECHO.BB_AEREO_HRSAIDA ASC                  ")
	qInsert.Add("                                                    FOR XML PATH (''))                                                                 ")
	qInsert.Add("                END  NUMEROVOOSTRECHOS,                                                                                                ")
	qInsert.Add("               (SELECT Count(TRECHO.HANDLE)                                                                                            ")
	qInsert.Add("                FROM   BB_TRECHOACCOUNTING TRE                                                                                         ")
	qInsert.Add("                       JOIN BB_PNRTRECHOS TRECHO                                                                                       ")
	qInsert.Add("                         ON ( TRECHO.HANDLE = TRE.TRECHO )                                                                             ")
	qInsert.Add("                WHERE  TRE.ACCOUNTING = ACC.HANDLE)                                                                                    ")
	qInsert.Add("                      QTDTRECHOS,                                                                                                      ")
	qInsert.Add("               (SELECT TOP 1 TR.BB_AEREO_ORIGEM + ' / '                                                                                ")
	qInsert.Add("                             + TR.BB_AEREO_DESTINO + ' - '                                                                             ")
	qInsert.Add("                             + CONVERT(CHAR(2), Cast(TR.BB_AEREO_DATA_VOO AS DATETIME), 103)                                           ")
	qInsert.Add("                             + '/'                                                                                                     ")
	qInsert.Add("                             + CONVERT(CHAR(2), Cast(TR.BB_AEREO_DATA_VOO AS DATETIME), 101)                                           ")
	qInsert.Add("                             + '/'                                                                                                     ")
	qInsert.Add("                             + CONVERT(CHAR(4), Cast(TR.BB_AEREO_DATA_VOO AS DATETIME), 102)                                           ")
	qInsert.Add("                             + ' -' + TR.BB_AEREO_HRSAIDA                                                                              ")
	qInsert.Add("                FROM   BB_PNRTRECHOS TR                                                                                                ")
	qInsert.Add("                       INNER JOIN BB_TRECHOACCOUNTING TA                                                                               ")
	qInsert.Add("                               ON TA.ACCOUNTING = ACC.HANDLE                                                                           ")
	qInsert.Add("                WHERE  TR.HANDLE = TA.TRECHO                                                                                           ")
	qInsert.Add("                ORDER  BY TR.HANDLE)                                                                                                   ")
	qInsert.Add("               TRECHO1                                                                                                                 ")
	qInsert.Add("                      ,                                                                                                                ")
	qInsert.Add("               (SELECT TOP 1 TR.BB_AEREO_ORIGEM + ' / '                                                                                ")
	qInsert.Add("                             + TR.BB_AEREO_DESTINO + ' - '                                                                             ")
	qInsert.Add("                             + CONVERT(CHAR(2), Cast(TR.BB_AEREO_DATA_VOO AS DATETIME), 103)                                           ")
	qInsert.Add("                             + '/'                                                                                                     ")
	qInsert.Add("                             + CONVERT(CHAR(2), Cast(TR.BB_AEREO_DATA_VOO AS DATETIME), 101)                                           ")
	qInsert.Add("                             + '/'                                                                                                     ")
	qInsert.Add("                             + CONVERT(CHAR(4), Cast(TR.BB_AEREO_DATA_VOO AS DATETIME), 102)                                           ")
	qInsert.Add("                             + ' -' + TR.BB_AEREO_HRSAIDA                                                                              ")
	qInsert.Add("                FROM   BB_PNRTRECHOS TR                                                                                                ")
	qInsert.Add("                       INNER JOIN BB_TRECHOACCOUNTING TA                                                                               ")
	qInsert.Add("                               ON TA.ACCOUNTING = ACC.HANDLE                                                                           ")
	qInsert.Add("                WHERE  TR.HANDLE = TA.TRECHO                                                                                           ")
	qInsert.Add("                       AND TR.HANDLE NOT IN (SELECT TOP 1 TR.HANDLE                                                                    ")
	qInsert.Add("                                             FROM   BB_PNRTRECHOS TR                                                                   ")
	qInsert.Add("                                                    INNER JOIN BB_TRECHOACCOUNTING TA                                                  ")
	qInsert.Add("                                                            ON TA.ACCOUNTING = ACC.HANDLE                                              ")
	qInsert.Add("                                             WHERE  TR.HANDLE = TA.TRECHO                                                              ")
	qInsert.Add("                                             ORDER  BY TR.HANDLE)                                                                      ")
	qInsert.Add("                ORDER  BY TR.HANDLE)                                                                                                   ")
	qInsert.Add("               TRECHO2                                                                                                                 ")
	qInsert.Add("                      ,                                                                                                                ")
	qInsert.Add("               (SELECT TOP 1 TR.BB_AEREO_ORIGEM + ' / '                                                                                ")
	qInsert.Add("                             + TR.BB_AEREO_DESTINO + ' - '                                                                             ")
	qInsert.Add("                             + CONVERT(CHAR(2), Cast(TR.BB_AEREO_DATA_VOO AS DATETIME), 103)                                           ")
	qInsert.Add("                             + '/'                                                                                                     ")
	qInsert.Add("                             + CONVERT(CHAR(2), Cast(TR.BB_AEREO_DATA_VOO AS DATETIME), 101)                                           ")
	qInsert.Add("                             + '/'                                                                                                     ")
	qInsert.Add("                             + CONVERT(CHAR(4), Cast(TR.BB_AEREO_DATA_VOO AS DATETIME), 102)                                           ")
	qInsert.Add("                             + ' -' + TR.BB_AEREO_HRSAIDA                                                                              ")
	qInsert.Add("                FROM   BB_PNRTRECHOS TR                                                                                                ")
	qInsert.Add("                       INNER JOIN BB_TRECHOACCOUNTING TA                                                                               ")
	qInsert.Add("                               ON TA.ACCOUNTING = ACC.HANDLE                                                                           ")
	qInsert.Add("                WHERE  TR.HANDLE = TA.TRECHO                                                                                           ")
	qInsert.Add("                       AND TR.HANDLE NOT IN (SELECT TOP 2 TR.HANDLE                                                                    ")
	qInsert.Add("                                             FROM   BB_PNRTRECHOS TR                                                                   ")
	qInsert.Add("                                                    INNER JOIN BB_TRECHOACCOUNTING TA                                                  ")
	qInsert.Add("                                                            ON TA.ACCOUNTING = ACC.HANDLE                                              ")
	qInsert.Add("                                             WHERE  TR.HANDLE = TA.TRECHO                                                              ")
	qInsert.Add("                                             ORDER  BY TR.HANDLE)                                                                      ")
	qInsert.Add("                ORDER  BY TR.HANDLE)                                                                                                   ")
	qInsert.Add("               TRECHO3                                                                                                                 ")
	qInsert.Add("                      ,                                                                                                                ")
	qInsert.Add("               (SELECT TOP 1 TR.BB_AEREO_ORIGEM + ' / '                                                                                ")
	qInsert.Add("                             + TR.BB_AEREO_DESTINO + ' - '                                                                             ")
	qInsert.Add("                             + CONVERT(CHAR(2), Cast(TR.BB_AEREO_DATA_VOO AS DATETIME), 103)                                           ")
	qInsert.Add("                             + '/'                                                                                                     ")
	qInsert.Add("                             + CONVERT(CHAR(2), Cast(TR.BB_AEREO_DATA_VOO AS DATETIME), 101)                                           ")
	qInsert.Add("                             + '/'                                                                                                     ")
	qInsert.Add("                             + CONVERT(CHAR(4), Cast(TR.BB_AEREO_DATA_VOO AS DATETIME), 102)                                           ")
	qInsert.Add("                             + ' -' + TR.BB_AEREO_HRSAIDA                                                                              ")
	qInsert.Add("                FROM   BB_PNRTRECHOS TR                                                                                                ")
	qInsert.Add("                       INNER JOIN BB_TRECHOACCOUNTING TA                                                                               ")
	qInsert.Add("                               ON TA.ACCOUNTING = ACC.HANDLE                                                                           ")
	qInsert.Add("                WHERE  TR.HANDLE = TA.TRECHO                                                                                           ")
	qInsert.Add("                       AND TR.HANDLE NOT IN (SELECT TOP 3 TR.HANDLE                                                                    ")
	qInsert.Add("                                             FROM   BB_PNRTRECHOS TR                                                                   ")
	qInsert.Add("                                                    INNER JOIN BB_TRECHOACCOUNTING TA                                                  ")
	qInsert.Add("                                                            ON TA.ACCOUNTING = ACC.HANDLE                                              ")
	qInsert.Add("                                             WHERE  TR.HANDLE = TA.TRECHO                                                              ")
	qInsert.Add("                                             ORDER  BY TR.HANDLE)                                                                      ")
	qInsert.Add("                ORDER  BY TR.HANDLE)                                                                                                   ")
	qInsert.Add("               TRECHO4                                                                                                                 ")
	qInsert.Add("                      ,                                                                                                                ")
	qInsert.Add("               ACC.SITUACAO,                                                                                                           ")
	qInsert.Add("               BB.REEMISSAO,                                                                                                           ")
	qInsert.Add("               ACC.TARIFACHEIA,                                                                                                        ")
	qInsert.Add("               ACC.TARIFAMINIMA,                                                                                                       ")
	qInsert.Add("               EVE.HANDLE                                                                                                              ")
	qInsert.Add("                      HANDLEEVENTO,                                                                                                    ")
	qInsert.Add("               EVE.EVENTO,                                                                                                             ")
	qInsert.Add("               ACC.FORMARECEBIMENTO,                                                                                                   ")
	qInsert.Add("               CASE                                                                                                                    ")
	qInsert.Add("                 WHEN ACC.FORMARECEBIMENTO = 1 THEN 'Cash'                                                                             ")
	qInsert.Add("                 WHEN ACC.FORMARECEBIMENTO = 3 THEN 'Faturado'                                                                         ")
	qInsert.Add("                 WHEN ACC.FORMARECEBIMENTO = 5 THEN 'Cheque'                                                                           ")
	qInsert.Add("                 WHEN ACC.FORMARECEBIMENTO = 6 THEN 'Pagamento direto'                                                                 ")
	qInsert.Add("                 WHEN ACC.FORMARECEBIMENTO = 7 THEN 'Cart√£o'                                                                           ")
	qInsert.Add("                 WHEN ACC.FORMARECEBIMENTO = 9 THEN 'Cart√£o conv√™nio'                                                                  ")
	qInsert.Add("                 WHEN ACC.FORMARECEBIMENTO = 10 THEN 'Sem adicional'                                                                   ")
	qInsert.Add("                 WHEN ACC.FORMARECEBIMENTO = 11 THEN 'Cart√£o AMEX'                                                                     ")
	qInsert.Add("                 WHEN ACC.FORMARECEBIMENTO = 12 THEN 'Governo'                                                                         ")
	qInsert.Add("                 WHEN ACC.FORMARECEBIMENTO = 13 THEN 'Cheque pr√©-datado'                                                               ")
	qInsert.Add("                 WHEN ACC.FORMARECEBIMENTO = 14 THEN 'Vendas financiadas por terceiros'                                                ")
	qInsert.Add("                 WHEN ACC.FORMARECEBIMENTO = 15 THEN 'M√∫ltiplos recebimentos'                                                          ")
	qInsert.Add("                 WHEN ACC.FORMARECEBIMENTO = 16 THEN 'Despesas internas'                                                               ")
	qInsert.Add("                 WHEN ACC.FORMARECEBIMENTO = 17 THEN 'TKT'                                                                             ")
	qInsert.Add("                 WHEN ACC.FORMARECEBIMENTO = 18 THEN 'MCO'                                                                             ")
	qInsert.Add("               END  FORMARECEBIMENTODESC,                                                                                              ")
	qInsert.Add("               CONSOLIDADOR.HANDLE HANDLECONSOLIDADOR,                                                                                 ")
	qInsert.Add("               CONSOLIDADOR.NOME CONSOLIDADOR,                                                                                         ")
	qInsert.Add("               ACC.INFOS,                                                                                                              ")
	qInsert.Add("               PROMOTOR.HANDLE HANDLEPROMOTOR,                                                                                         ")
	qInsert.Add("               PROMOTOR.NOME PROMOTOR,                                                                                                 ")

	qInsert.Add("               PROMOTORMANUTENCAO.HANDLE HANDLEPROMOTORMANUTENCAO,                                                                                         ")
	qInsert.Add("               PROMOTORMANUTENCAO.NOME PROMOTORMANUTENCAO,                                                                                                 ")

	qInsert.Add("			   ACC.VALOROVERREPASSADO,                                                                                                          ")
	qInsert.Add("			   MUNICIPIOFORNECEDOR.NOME MUNICIPIOFORNECEDOR,                                                                                    ")
	qInsert.Add("			   CASE                                                                                                                             ")
	qInsert.Add("			     WHEN ACC.TIPOAPARTAMENTO = 1 THEN 'SGL'                                                                                        ")
	qInsert.Add("				 WHEN ACC.TIPOAPARTAMENTO = 2 THEN 'DBL'                                                                                           ")
	qInsert.Add("				 WHEN ACC.TIPOAPARTAMENTO = 3 THEN 'TPL'                                                                                           ")
	qInsert.Add("				 WHEN ACC.TIPOAPARTAMENTO = 4 THEN 'QAD'                                                                                           ")
	qInsert.Add("				 WHEN ACC.TIPOAPARTAMENTO = 5 THEN 'SUITE'                                                                                         ")
	qInsert.Add("			   END TIPOAPARTAMENTO ,                                                                                                            ")
	qInsert.Add("			   CASE                                                                                                                             ")
	qInsert.Add("			     WHEN ACC.FORMADEPAGAMENTO = 1 THEN 'Cart√£o'                                                                                    ")
	qInsert.Add("				 WHEN ACC.FORMADEPAGAMENTO = 2 THEN 'Invoice'                                                                                      ")
	qInsert.Add("				 WHEN ACC.FORMADEPAGAMENTO = 3 THEN 'Outras'                                                                                       ")
	qInsert.Add("				 WHEN ACC.FORMADEPAGAMENTO = 4 THEN 'GR'                                                                                           ")
	qInsert.Add("				 WHEN ACC.FORMADEPAGAMENTO = 5 THEN 'M√∫ltiplos pagamentos'                                                                         ")
	qInsert.Add("			   END FORMADEPAGAMENTODESC,                                                                                                        ")
	qInsert.Add("               ( SELECT TOP 1 CENTROCUSTO.HANDLE                                                                                       ")
	qInsert.Add("                 FROM CT_CC CENTROCUSTO                                                                                                ")
	qInsert.Add("                   JOIN BB_CCPROJETOACC CCPACC                                                                                         ")
	qInsert.Add("                     ON ( CENTROCUSTO.HANDLE = CCPACC.CCSUGERIDO  )                                                                    ")
	qInsert.Add("                 WHERE CCPACC.ACCOUNTING = ACC.HANDLE                                                                                  ")
	qInsert.Add("                 ORDER BY CCPACC.PERCENTUAL DESC  ) HANDLECENTROCUSTOINTERNO,                                                          ")
	qInsert.Add("               ( SELECT TOP 1 CENTROCUSTO.NOME                                                                                         ")
	qInsert.Add("                 FROM CT_CC CENTROCUSTO                                                                                                ")
	qInsert.Add("                   JOIN BB_CCPROJETOACC CCPACC                                                                                         ")
	qInsert.Add("                     ON ( CENTROCUSTO.HANDLE = CCPACC.CCSUGERIDO  )                                                                    ")
	qInsert.Add("                 WHERE CCPACC.ACCOUNTING = ACC.HANDLE                                                                                  ")
	qInsert.Add("                 ORDER BY CCPACC.PERCENTUAL DESC  ) NOMECENTROCUSTOINTERNO,                                                             ")
	qInsert.Add("                 ISNULL(ACC.TARIFA,0) TARIFAEMISSAO, ")
	qInsert.Add("                 ( ISNULL(ACC.TAXA,0) + ISNULL(ACC.OUTRASTAXAS,0) + ISNULL(ACC.EXTRAS,0) ) TAXASEMISSAO, ")
	qInsert.Add("                 ISNULL(ACC.TAXADU, 0) TAXADUEMISSAO,  ")
	qInsert.Add("                 ISNULL(ACC.COMISSAO,0) COMISSAOEMISSAO,  ")
	qInsert.Add(" ( SELECT  ISNULL( MIN(VD.CONCILIADO) ,'N' ) FROM   BB_VENDASDOCUMENTOS VD (NOLOCK) WHERE ACC.HANDLE = VD.ACCOUNTING AND VD.PESSOA = ACC.FORNECEDOR AND VD.CONCILIADO = 'S' ")
	qInsert.Add(" AND VD.ENTRADASAIDA = 'E' AND ( ( VD.CANCELADO = 'N' ) OR ( VD.CANCELADO IS NULL ) ) ) TOTALMENTECONCILIADO, ")
	qInsert.Add("                 CONTINENTE.NOME CONTINENTE, 																							")
	qInsert.Add("                 REGIAO.NOME REGIAO, 																									")
	qInsert.Add("                 ESTADOFORNECEDOR.HANDLE HANDLEESTADOFORNECEDOR, 																		")
	qInsert.Add("                 ESTADOFORNECEDOR.NOME NOMEESTADOFORNECEDOR, 																			")
	qInsert.Add("                 PAIS.HANDLE HANDLEPAISFORNECEDOR, 																					")
	qInsert.Add("                 PAIS.NOME NOMEPAISFORNECEDOR, 																						")
	qInsert.Add("                 NULL HANDLEVIAGEM, 																									")
	qInsert.Add("                 NULL NOMEVIAGEM, 																										")
	qInsert.Add("                 VIAJANTE.HANDLE HANDLEVIAJANTE, 																						")
	qInsert.Add("                 VIAJANTE.NOME NOMEVIAJANTE,  																							")

	qInsert.Add("				  (SELECT TOP 1 XX.VALOR FROM BB_DOCUMENTOINFCTRL XX WHERE XX.ACCOUNTING = ACC.HANDLE AND XX.INFORMACAO IN (			")
	qInsert.Add("					SELECT XXX.HANDLE FROM BB_CLIENTEINFCTRL XXX WHERE XXX.HANDLE = XX.INFORMACAO 										")
	qInsert.Add("					AND UPPER(XXX.INFORMACAO) = 'MENORTARIFA')) MENORTARIFA,															")

	qInsert.Add("				  (SELECT TOP 1 XX.VALOR FROM BB_DOCUMENTOINFCTRL XX WHERE XX.ACCOUNTING = ACC.HANDLE AND XX.INFORMACAO IN (			")
	qInsert.Add("					SELECT XXX.HANDLE FROM BB_CLIENTEINFCTRL XXX WHERE XXX.HANDLE = XX.INFORMACAO 										")
	qInsert.Add("					AND UPPER(XXX.INFORMACAO) = 'JUSTIFICATIVAMENORTARIFA')) JUSTIFICATIVAMENORTARIFA,									")

	qInsert.Add("				  (SELECT TOP 1 XX.VALOR FROM BB_DOCUMENTOINFCTRL XX WHERE XX.ACCOUNTING = ACC.HANDLE AND XX.INFORMACAO IN (			")
	qInsert.Add("					SELECT XXX.HANDLE FROM BB_CLIENTEINFCTRL XXX WHERE XXX.HANDLE = XX.INFORMACAO 										")
	qInsert.Add("					AND UPPER(XXX.INFORMACAO) = 'ANTECEDENCIAMINIMA')) ANTECEDENCIAMINIMA,												")

	qInsert.Add("				  (SELECT TOP 1 XX.VALOR FROM BB_DOCUMENTOINFCTRL XX WHERE XX.ACCOUNTING = ACC.HANDLE AND XX.INFORMACAO IN (			")
	qInsert.Add("					SELECT XXX.HANDLE FROM BB_CLIENTEINFCTRL XXX WHERE XXX.HANDLE = XX.INFORMACAO 										")
	qInsert.Add("					AND UPPER(XXX.INFORMACAO) = 'JUSTIFICATIVAANTECEDENCIA')) JUSTIFICATIVAANTECEDENCIA,								")

	qInsert.Add("				  (SELECT TOP 1 XX.VALOR FROM BB_DOCUMENTOINFCTRL XX WHERE XX.ACCOUNTING = ACC.HANDLE AND XX.INFORMACAO IN (			")
	qInsert.Add("					SELECT XXX.HANDLE FROM BB_CLIENTEINFCTRL XXX WHERE XXX.HANDLE = XX.INFORMACAO 										")
	qInsert.Add("					AND UPPER(XXX.INFORMACAO) = 'CIAPREFERENCIAL')) CIAPREFERENCIAL,													")

	qInsert.Add("				  (SELECT TOP 1 XX.VALOR FROM BB_DOCUMENTOINFCTRL XX WHERE XX.ACCOUNTING = ACC.HANDLE AND XX.INFORMACAO IN (			")
	qInsert.Add("					SELECT XXX.HANDLE FROM BB_CLIENTEINFCTRL XXX WHERE XXX.HANDLE = XX.INFORMACAO 										")
	qInsert.Add("					AND UPPER(XXX.INFORMACAO) = 'JUSTIFICATIVACIAPREFERENCIAL')) JUSTIFICATIVACIAPREFERENCIAL,							")

	qInsert.Add("				  (SELECT TOP 1 XX.VALOR FROM BB_DOCUMENTOINFCTRL XX WHERE XX.ACCOUNTING = ACC.HANDLE AND XX.INFORMACAO IN (			")
	qInsert.Add("					SELECT XXX.HANDLE FROM BB_CLIENTEINFCTRL XXX WHERE XXX.HANDLE = XX.INFORMACAO 										")
	qInsert.Add("					AND UPPER(XXX.INFORMACAO) = 'SELECIONARCIA')) SELECIONARCIA,														")

	qInsert.Add("				  (SELECT TOP 1 XX.VALOR FROM BB_DOCUMENTOINFCTRL XX WHERE XX.ACCOUNTING = ACC.HANDLE AND XX.INFORMACAO IN (			")
	qInsert.Add("					SELECT XXX.HANDLE FROM BB_CLIENTEINFCTRL XXX WHERE XXX.HANDLE = XX.INFORMACAO 										")
	qInsert.Add("					AND UPPER(XXX.INFORMACAO) = 'JUSTIFICATIVASELECIONARCIA')) JUSTIFICATIVASELECIONARCIA,								")

	qInsert.Add("				  (SELECT TOP 1 XX.VALOR FROM BB_DOCUMENTOINFCTRL XX WHERE XX.ACCOUNTING = ACC.HANDLE AND XX.INFORMACAO IN (			")
	qInsert.Add("					SELECT XXX.HANDLE FROM BB_CLIENTEINFCTRL XXX WHERE XXX.HANDLE = XX.INFORMACAO 										")
	qInsert.Add("					AND UPPER(XXX.INFORMACAO) = 'VOOSMENORTARIFA')) VOOSMENORTARIFA,													")

	qInsert.Add("				  (SELECT TOP 1 XX.VALOR FROM BB_DOCUMENTOINFCTRL XX WHERE XX.ACCOUNTING = ACC.HANDLE AND XX.INFORMACAO IN (			")
	qInsert.Add("					SELECT XXX.HANDLE FROM BB_CLIENTEINFCTRL XXX WHERE XXX.HANDLE = XX.INFORMACAO 										")
	qInsert.Add("					AND UPPER(XXX.INFORMACAO) = 'REMARCACAO')) REMARCACAO,																")

	qInsert.Add("				  (SELECT TOP 1 XX.VALOR FROM BB_DOCUMENTOINFCTRL XX WHERE XX.ACCOUNTING = ACC.HANDLE AND XX.INFORMACAO IN (			")
	qInsert.Add("					SELECT XXX.HANDLE FROM BB_CLIENTEINFCTRL XXX WHERE XXX.HANDLE = XX.INFORMACAO 										")
	qInsert.Add("					AND UPPER(XXX.INFORMACAO) = 'DATAAUTORIZACAO')) DATAAUTORIZACAO,													")

	qInsert.Add("				  (SELECT TOP 1 XX.VALOR FROM BB_DOCUMENTOINFCTRL XX WHERE XX.ACCOUNTING = ACC.HANDLE AND XX.INFORMACAO IN (			")
	qInsert.Add("					SELECT XXX.HANDLE FROM BB_CLIENTEINFCTRL XXX WHERE XXX.HANDLE = XX.INFORMACAO 										")
	qInsert.Add("					AND UPPER(XXX.INFORMACAO) = 'TIPOPAX')) TIPOPAX,																	")

	qInsert.Add("				  (SELECT TOP 1 XX.VALOR FROM BB_DOCUMENTOINFCTRL XX WHERE XX.ACCOUNTING = ACC.HANDLE AND XX.INFORMACAO IN (			")
	qInsert.Add("					SELECT XXX.HANDLE FROM BB_CLIENTEINFCTRL XXX WHERE XXX.HANDLE = XX.INFORMACAO 										")
	qInsert.Add("					AND UPPER(XXX.INFORMACAO) = 'ORIGEMEMISSAO')) ORIGEMEMISSAO,														")

	qInsert.Add("				  (SELECT TOP 1 XX.VALOR FROM BB_DOCUMENTOINFCTRL XX WHERE XX.ACCOUNTING = ACC.HANDLE AND XX.INFORMACAO IN (			")
	qInsert.Add("					SELECT XXX.HANDLE FROM BB_CLIENTEINFCTRL XXX WHERE XXX.HANDLE = XX.INFORMACAO 										")
	qInsert.Add("					AND UPPER(XXX.INFORMACAO) = 'CARGOPASSAGEIRO')) CARGOPASSAGEIRO,													")

	qInsert.Add("				  (SELECT TOP 1 XX.VALOR FROM BB_DOCUMENTOINFCTRL XX WHERE XX.ACCOUNTING = ACC.HANDLE AND XX.INFORMACAO IN (			")
	qInsert.Add("					SELECT XXX.HANDLE FROM BB_CLIENTEINFCTRL XXX WHERE XXX.HANDLE = XX.INFORMACAO 										")
	qInsert.Add("					AND UPPER(XXX.INFORMACAO) = 'CARGOAUTORIZADOR')) CARGOAUTORIZADOR													")

	qInsert.Add("        FROM   BB_PNRACCOUNTINGS ACC ( NOLOCK )                                                                                        ")
	qInsert.Add("               LEFT JOIN GN_PESSOAS FORNECEDOR ( NOLOCK )                                                                              ")
	qInsert.Add("                      ON ( FORNECEDOR.HANDLE = ACC.FORNECEDOR )                                                                        ")
	qInsert.Add("               LEFT JOIN GN_PESSOACONTATOS SOLICITANTE                                                                                 ")
	qInsert.Add("                      ON ( SOLICITANTE.HANDLE = ACC.SOLICITANTE )                                                                      ")
	qInsert.Add("               LEFT JOIN BB_CLIENTECC CENTROCUSTO                                                                                      ")
	qInsert.Add("                      ON ( CENTROCUSTO.HANDLE = ACC.CENTRODECUSTO )                                                                    ")
	qInsert.Add("               LEFT JOIN PAISES PAIS                                                                                                   ")
	qInsert.Add("                      ON ( PAIS.HANDLE = FORNECEDOR.PAIS )                                                                             ")
	qInsert.Add("               LEFT JOIN K_REGIOES CONTINENTE ON ( CONTINENTE.HANDLE = PAIS.K_CONTINENTE )                                             ")

	qInsert.Add("               LEFT JOIN ESTADOS ESTADOFORNECEDOR                                                                                      ")
	qInsert.Add("                      ON ( ESTADOFORNECEDOR.HANDLE = FORNECEDOR.ESTADO )                                                               ")

	qInsert.Add("               LEFT JOIN K_REGIOES REGIAO ON ( REGIAO.HANDLE = ESTADOFORNECEDOR.K_REGIAO )				       							")

	qInsert.Add("               LEFT JOIN MUNICIPIOS MUNICIPIOFORNECEDOR                                                                                ")
	qInsert.Add("                      ON ( MUNICIPIOFORNECEDOR.HANDLE = FORNECEDOR.MUNICIPIO )                                                         ")
	qInsert.Add("               LEFT JOIN GN_CATEGORIASFORNECEDORES TIPOFORNECEDOR ( NOLOCK )                                                           ")
	qInsert.Add("                      ON ( TIPOFORNECEDOR.HANDLE = FORNECEDOR.CATEGORIAFORNECEDOR )                                                    ")
	qInsert.Add("               LEFT JOIN GN_PESSOAS CONSOLIDADOR ( NOLOCK )                                                                            ")
	qInsert.Add("                      ON ( CONSOLIDADOR.HANDLE = ACC.CONSOLIDADOR )                                                                    ")
	qInsert.Add("               LEFT JOIN GN_PESSOAS CLIENTE ( NOLOCK )                                                                                 ")
	qInsert.Add("                      ON ( CLIENTE.HANDLE = ACC.BB_CLIENTE )                                                                           ")
	qInsert.Add("               LEFT JOIN GN_PESSOAS PROMOTOR ( NOLOCK )                                                                                ")
	qInsert.Add("                      ON ( PROMOTOR.HANDLE = CLIENTE.PROMOTOR )                                                                        ")

	qInsert.Add("               LEFT JOIN GN_PESSOAS PROMOTORMANUTENCAO                                                                                 ")
	qInsert.Add("                      ON ( PROMOTORMANUTENCAO.HANDLE = CLIENTE.K_PROMOTORMANUTENCAO )                                                  ")

	qInsert.Add("               LEFT JOIN GN_PESSOAS VIAJANTE                                                                                 			")
	qInsert.Add("                      ON ( VIAJANTE.HANDLE = ACC.VIAJANTE )                                                  							")

	qInsert.Add("               LEFT JOIN GN_GRUPOSEMPRESARIAIS GRUPOEMPRESARIAL ( NOLOCK )                                                             ")
	qInsert.Add("                      ON ( GRUPOEMPRESARIAL.HANDLE = CLIENTE.GRUPOEMPRESARIAL )                                                        ")
	qInsert.Add("               LEFT JOIN GN_PESSOAS GRUPOEMPRESARIALPESSOA ( NOLOCK )                                                                  ")
	qInsert.Add("                      ON ( GRUPOEMPRESARIALPESSOA.HANDLE = GRUPOEMPRESARIAL.PESSOA )                                                   ")
	qInsert.Add("               LEFT JOIN GN_CATEGORIASCLIENTE TIPOCLIENTE ( NOLOCK )                                                                   ")
	qInsert.Add("                      ON ( TIPOCLIENTE.HANDLE = CLIENTE.CATEGORIACLIENTE )                                                             ")
	qInsert.Add("               LEFT JOIN BB_AGENTES AGENTE ( NOLOCK )                                                                                  ")
	qInsert.Add("                      ON ( AGENTE.HANDLE = ACC.AGENTE_EMISSAO )                                                                        ")
	qInsert.Add("               LEFT JOIN BB_MAQUINAS PCC ( NOLOCK )                                                                                    ")
	qInsert.Add("                      ON ( PCC.HANDLE = ACC.PCC_EMISSAO )                                                                              ")
	qInsert.Add("               LEFT JOIN FILIAIS FILIAL ( NOLOCK )                                                                                     ")
	qInsert.Add("                      ON ( FILIAL.HANDLE = ACC.FILIAL )                                                                                ")
	qInsert.Add("               INNER JOIN BB_PNRS BB ( NOLOCK )                                                                                        ")
	qInsert.Add("                       ON ( ACC.RLOC = BB.HANDLE )                                                                                     ")
	qInsert.Add("               LEFT JOIN BB_BSPACCALTERACOES BSPALT ( NOLOCK )                                                                         ")
	qInsert.Add("                      ON ( BSPALT.ACCOUNTING = ACC.HANDLE )                                                                            ")
	qInsert.Add("               LEFT JOIN AE_EVENTOS EVE ( NOLOCK )                                                                                     ")
	qInsert.Add("                      ON ( EVE.HANDLE = ACC.EVENTO )                                                                                   ")
	qInsert.Add("               LEFT JOIN BB_TIPOSORIGEMPEDIDO ORIGEMPEDIDO                                                                             ")
	qInsert.Add("                      ON ( ORIGEMPEDIDO.HANDLE = ACC.ORIGEMPEDIDO )                                                                    ")
	qInsert.Add("               LEFT JOIN (SELECT VIRT.ACCOUNTING,                                                                                      ")
	qInsert.Add("                                 VIRT.PESSOA,                                                                                          ")
	qInsert.Add("                                 VIRT.ENTRADASAIDA,                                                                                    ")
	qInsert.Add("                                 Sum(ISNULL(VIRT.DESCONTOCONCEDIDO, 0))    DESCONTO,                                                   ")
	qInsert.Add("                                 Sum(ISNULL(VIRT.ABATIMENTO, 0))           ABATIMENTO,                                                 ")
	qInsert.Add("                                 Sum(ISNULL(VIRT.TAXAAJUSTADA, 0)                                                                      ")
	qInsert.Add("                                     + ISNULL(VIRT.OUTRASTAXASAJUSTADAS, 0)                                                            ")
	qInsert.Add("                                     + ISNULL(VIRT.ALIMENTACAO, 0)                                                                     ")
	qInsert.Add("                                     + ISNULL(VIRT.EXTRAS, 0)                                                                          ")
	qInsert.Add("                                     + ISNULL(VIRT.MULTA, 0))              TAXAS,                                                      ")
	qInsert.Add("                                 Sum(ISNULL(VIRT.VALORNOMINALAJUSTADO, 0)) TARIFA,                                                     ")
	qInsert.Add("                                 Sum(ISNULL(VIRT.MANAGEMENTFEE, 0))        MANAGEMENTFEE,                                              ")
	qInsert.Add("                                 Sum(ISNULL(VIRT.MARKUP, 0))               MARKUP,                                                     ")
	qInsert.Add("                                 Sum(ISNULL(VIRT.COMISSOES, 0))            COMISSAO                                                    ")
	qInsert.Add("                          FROM   BB_VENDASDOCUMENTOS VIRT (NOLOCK)                                                                     ")
	qInsert.Add("                          WHERE  ( ( VIRT.FORMARECEBIMENTO IN ( 3, 12 ) )                                                              ")
	qInsert.Add("                                    OR ( VIRT.FORMARECEBIMENTO = 1                                                                     ")
	qInsert.Add("                                         AND VIRT.MANAGEMENTFEE <> VIRT.VALORNOMINALLIQUIDO ) )                                        ")
	qInsert.Add("                                 AND VIRT.ENTRADASAIDA = 'S'                                                                           ")
	qInsert.Add("                                 AND ( ( VIRT.CANCELADO = 'N' )                                                                        ")
	qInsert.Add("                                        OR ( VIRT.CANCELADO IS NULL ) )                                                                ")
	qInsert.Add("                                 AND ( ( ( VIRT.PREVISAO = 'N' )                                                                       ")
	qInsert.Add("                                          OR ( VIRT.PREVISAO IS NULL ) )                                                               ")
	qInsert.Add("                                        OR ( VIRT.FATURADO = 'S' ) )                                                                   ")
	qInsert.Add("                          GROUP  BY VIRT.ACCOUNTING,                                                                                   ")
	qInsert.Add("                                    VIRT.PESSOA,                                                                                       ")
	qInsert.Add("                                    VIRT.ENTRADASAIDA) VENDASDOC                                                                       ")
	qInsert.Add("                      ON ( VENDASDOC.ACCOUNTING = ACC.HANDLE                                                                           ")
	qInsert.Add("                           AND VENDASDOC.PESSOA = ACC.BB_CLIENTE )                                                                     ")
	qInsert.Add("               LEFT JOIN (SELECT VIRT.ACCOUNTING,                                                                                      ")
	qInsert.Add("                                 Sum(ISNULL(VIRT.DESCONTO, 0)                                                                          ")
	qInsert.Add("                                     + ISNULL(VIRT.ABATIMENTO, 0)) DESCONTO                                                            ")
	qInsert.Add("                          FROM   BB_VENDASDOCUMENTOS VIRT (NOLOCK)                                                                     ")
	qInsert.Add("                                 JOIN BB_PNRACCOUNTINGS ACCV                                                                           ")
	qInsert.Add("                                   ON ( ACCV.HANDLE = VIRT.ACCOUNTING )                                                                ")
	qInsert.Add("                          WHERE  VIRT.ENTRADASAIDA = 'S'                                                                               ")
	qInsert.Add("                                 AND ( ( VIRT.CANCELADO = 'N' )                                                                        ")
	qInsert.Add("                                        OR ( VIRT.CANCELADO IS NULL ) )                                                                ")
	qInsert.Add("                                 AND ( ( VIRT.PREVISAO = 'N' )                                                                         ")
	qInsert.Add("                                        OR ( VIRT.PREVISAO IS NULL ) )                                                                 ")
	qInsert.Add("                                 AND VIRT.PESSOA <> ACCV.BB_CLIENTE                                                                    ")
	qInsert.Add("                                 AND VIRT.PESSOA <> ACCV.FORNECEDOR                                                                    ")
	qInsert.Add("                          GROUP  BY VIRT.ACCOUNTING) ADMCARTAO                                                                         ")
	qInsert.Add("                      ON ( ADMCARTAO.ACCOUNTING = ACC.HANDLE )                                                                         ")
	qInsert.Add("               LEFT JOIN (SELECT Sum(ISNULL(VALORNOMINALAJUSTADO, 0)) VALORNOMINALAJUSTADO,                                            ")
	qInsert.Add("                                 ACC.HANDLE                                                                                            ")
	qInsert.Add("                          FROM   BB_VENDASDOCUMENTOS VD (NOLOCK)                                                                       ")
	qInsert.Add("                                 JOIN BB_PNRACCOUNTINGS ACC (NOLOCK)                                                                   ")
	qInsert.Add("                                   ON ( ACC.HANDLE = VD.ACCOUNTING )                                                                   ")
	qInsert.Add("                          WHERE  VD.PESSOA = ACC.FORNECEDOR                                                                            ")
	qInsert.Add("                                 AND VD.ENTRADASAIDA = 'S'                                                                             ")
	qInsert.Add("                          GROUP  BY ACC.HANDLE) COMI                                                                                   ")
	qInsert.Add("                      ON ( COMI.HANDLE = ACC.HANDLE )                                                                                  ")
	qInsert.Add("               LEFT JOIN (SELECT VD.PESSOA,                                                                                            ")
	qInsert.Add("                                 Sum(ISNULL(VD.COMISSOES, 0)) COMISSAO,                                                                ")
	qInsert.Add("                                 ACC.HANDLE                                                                                            ")
	qInsert.Add("                          FROM   BB_VENDASDOCUMENTOS VD (NOLOCK)                                                                       ")
	qInsert.Add("                                 JOIN BB_PNRACCOUNTINGS ACC (NOLOCK)                                                                   ")
	qInsert.Add("                                   ON ( ACC.HANDLE = VD.ACCOUNTING )                                                                   ")
	qInsert.Add("                          WHERE  VD.PESSOA = ACC.FORNECEDOR                                                                            ")
	qInsert.Add("                                 AND VD.ENTRADASAIDA = 'E'                                                                             ")
	qInsert.Add("                                 AND VD.CONCILIADO = 'S'                                                                               ")
	qInsert.Add("                                 AND ( VD.FORMAPAGAMENTO IN ( 2, 4 )                                                                   ")
	qInsert.Add("                                        OR ( ( VD.FORMAPAGAMENTO IN ( 1, 3 ) )                                                         ")
	qInsert.Add("                                             AND ( VD.DOCUMENTO IS NOT NULL ) ) )                                                      ")
	qInsert.Add("                          GROUP  BY VD.PESSOA,                                                                                         ")
	qInsert.Add("                                    ACC.HANDLE) COMIFOR                                                                                ")
	qInsert.Add("                      ON ( COMIFOR.HANDLE = ACC.HANDLE                                                                                 ")
	qInsert.Add("                           AND COMIFOR.PESSOA = ACC.FORNECEDOR )                                                                       ")
	qInsert.Add("               LEFT JOIN (SELECT VD.PESSOA,                                                                                            ")
	qInsert.Add("                                 Sum(ISNULL(VD.VALORNOMINALAJUSTADO, 0))           TARIFA,                                             ")
	qInsert.Add("                                 Sum(ISNULL(VD.TAXAAJUSTADA, 0)                                                                        ")
	qInsert.Add("                                     + ISNULL(VD.OUTRASTAXASAJUSTADAS, 0)                                                              ")
	qInsert.Add("                                     + ISNULL(VD.ALIMENTACAO, 0)                                                                       ")
	qInsert.Add("                                     + ISNULL(VD.EXTRAS, 0) + ISNULL(VD.MULTA, 0)) TAXAS,                                              ")
	qInsert.Add("                                 ACC.HANDLE,                                                                                           ")
	qInsert.Add("                                 VD.CONCILIADO                                                                                         ")
	qInsert.Add("                          FROM   BB_VENDASDOCUMENTOS VD (NOLOCK)                                                                       ")
	qInsert.Add("                                 JOIN BB_PNRACCOUNTINGS ACC (NOLOCK)                                                                   ")
	qInsert.Add("                                   ON ( ACC.HANDLE = VD.ACCOUNTING )                                                                   ")
	qInsert.Add("                          WHERE  VD.PESSOA = ACC.FORNECEDOR                                                                            ")
	qInsert.Add("                                 AND VD.CONCILIADO = 'S'                                                                               ")
	qInsert.Add("                                 AND VD.ENTRADASAIDA = 'E'                                                                             ")
	qInsert.Add("                                 AND ( ( VD.CANCELADO = 'N' )                                                                          ")
	qInsert.Add("                                        OR ( VD.CANCELADO IS NULL ) )                                                                  ")
	qInsert.Add("                          GROUP  BY VD.PESSOA,                                                                                         ")
	qInsert.Add("                                    ACC.HANDLE,                                                                                        ")
	qInsert.Add("                                    VD.CONCILIADO) ENTRADAFOR                                                                          ")
	qInsert.Add("                      ON ( ENTRADAFOR.HANDLE = ACC.HANDLE                                                                              ")
	qInsert.Add("                           AND ENTRADAFOR.PESSOA = ACC.FORNECEDOR )                                                                    ")
	qInsert.Add("               LEFT JOIN (SELECT MULTACC.HANDLE,                                                                                       ")
	qInsert.Add("                                 Sum(( ISNULL(MULTICOMI.VALORNOMINALAJUSTADO, 0) ) + ( ISNULL(MULTIENTRADAFOR.COMISSAO, 0) )) COMISSAO ")
	qInsert.Add("                          FROM   BB_PNRACCOUNTINGS MULTACC (NOLOCK)                                                                    ")
	qInsert.Add("                                 LEFT JOIN (SELECT Sum(ISNULL(VD.VALORNOMINALAJUSTADO, 0)) VALORNOMINALAJUSTADO,                       ")
	qInsert.Add("                                                   ACC.HANDLE                                                                          ")
	qInsert.Add("                                            FROM   BB_VENDASDOCUMENTOS VD (NOLOCK)                                                     ")
	qInsert.Add("                                                   JOIN BB_PNRACCOUNTINGS ACC (NOLOCK)                                                 ")
	qInsert.Add("                                                     ON ( ACC.HANDLE = VD.ACCOUNTING )                                                 ")
	qInsert.Add("                                            WHERE  VD.PESSOA = ACC.FORNECEDOR                                                          ")
	qInsert.Add("                                                   AND VD.ENTRADASAIDA = 'S'                                                           ")
	qInsert.Add("                                            GROUP  BY ACC.HANDLE) MULTICOMI                                                            ")
	qInsert.Add("                                        ON ( MULTICOMI.HANDLE = MULTACC.HANDLE )                                                       ")
	qInsert.Add("                                 LEFT JOIN (SELECT VD.PESSOA,                                                                          ")
	qInsert.Add("                                                   Sum(ISNULL(VD.COMISSOES, 0)) COMISSAO,                                              ")
	qInsert.Add("                                                   ACC.HANDLE                                                                          ")
	qInsert.Add("                                            FROM   BB_VENDASDOCUMENTOS VD (NOLOCK)                                                     ")
	qInsert.Add("                                                   JOIN BB_PNRACCOUNTINGS ACC (NOLOCK)                                                 ")
	qInsert.Add("                                                     ON ( ACC.HANDLE = VD.ACCOUNTING )                                                 ")
	qInsert.Add("                                            WHERE  VD.PESSOA = ACC.FORNECEDOR                                                          ")
	qInsert.Add("                                                   AND VD.ENTRADASAIDA = 'E'                                                           ")
	qInsert.Add("                                                   AND ( ( VD.CANCELADO = 'N' )                                                        ")
	qInsert.Add("                                                          OR ( VD.CANCELADO IS NULL ) )                                                ")
	qInsert.Add("                                            GROUP  BY VD.PESSOA,                                                                       ")
	qInsert.Add("                                                      ACC.HANDLE) MULTIENTRADAFOR                                                      ")
	qInsert.Add("                                        ON ( ( MULTIENTRADAFOR.HANDLE = MULTACC.HANDLE )                                               ")
	qInsert.Add("                                             AND ( MULTIENTRADAFOR.PESSOA = MULTACC.FORNECEDOR ) )                                     ")
	qInsert.Add("                          WHERE  MULTACC.FORMADEPAGAMENTO = 5                                                                          ")
	qInsert.Add("                          GROUP  BY MULTACC.HANDLE) MULTIPLAS                                                                          ")
	qInsert.Add("                      ON ( MULTIPLAS.HANDLE = ACC.HANDLE ) WHERE YEAR(ACC.DATAEMISSAO) >= 2015 ")
	qInsert.Add(" )  VENDABASE                                                                  ")
	qInsert.Add("ORDER  BY VENDABASE.HANDLECLIENTE                                                                                                      ")
	qInsert.ExecSQL
	If ( InTransaction ) Then Commit
FAIL:
	Set qInsert = Nothing
	If ( InTransaction ) Then Rollback
	If ( Err.Description <> "" ) Then
		Err.Raise Err.Number, Err.Source,"Atualizar ETL->"+ Err.Description, Err.HelpFile, Err.HelpContext
	End If

End Sub